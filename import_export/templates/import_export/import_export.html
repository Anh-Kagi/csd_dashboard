{% extends 'format/detail_format.html' %}

{% load static i18n %}

{% block card_header %}

    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" id="detail-list" role="tablist">

            <li class="nav-item active">
                <a class="nav-link active" href="#csd" role="tab" aria-controls="csd" aria-selected="true">
                    CSD Atelier
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#reman" role="tab" aria-controls="reman" aria-selected="false">
                    REMAN
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#tools" role="tab" aria-controls="tools" aria-selected="false">
                    Outils
                </a>
            </li>
        </ul>
    </div>

{% endblock %}

{% block customcss %}

    <link href="{% static 'css/custom.css' %}" rel="stylesheet">

{% endblock %}

{% block detail_content %}

    <div class="tab-content mt-3">

        <!-- Detail CSD Workshop -->
        <div class="tab-pane active" id="csd" role="tabpanel" aria-labelledby="csd-tab">

            {% include 'import_export/detail_csd.html' %}

        </div>

        <!-- Detail REMAN -->
        <div class="tab-pane" id="reman" role="tabpanel" aria-labelledby="reman-tab">

            {% include 'import_export/detail_reman.html' %}

        </div>

        <!-- Detail Tools -->
        <div class="tab-pane" id="tools" role="tabpanel" aria-labelledby="tools-tab">

            {% include 'import_export/detail_tools.html' %}

        </div>
    </div>

{% endblock %}

{% block customjs %}

    <script src="{% static 'celery_progress/celery_progress.js' %}"></script>

    <script type="application/javascript">
        $(function () {
            $("#export-corvet").on("submit", (e) => {
                e.preventDefault()
                let formData = new FormData($("#export-corvet")[0])
                // formData.append("csrfmiddlewaretoken", "{% csrf_token %}")
                $.ajax({
                    type: "POST",
                    url: "{% url 'import_export:export_corvet' %}",
                    data: formData,
                    contentType: false,
                    processData: false,
                    cache: false,
                    async: true,
                    success: function (res) {
                        getProgress(
                            res.task_id,
                            progressBarId = "export-corvet-progress-bar",
                            progressBarMessageId = "export-corvet-progress-message",
                            isDownloadFile = true
                        )
                    },
                    error: function (err) {
                        console.log(err);
                    },
                })
            })

            $("#export-corvet-vin").on("submit", (e) => {
                e.preventDefault()
                let formData = new FormData($("#export-corvet-vin")[0])
                // formData.append("csrfmiddlewaretoken", "{% csrf_token %}")
                $.ajax({
                    type: "POST",
                    url: "{% url 'import_export:export_corvet_vin' %}",
                    data: formData,
                    contentType: false,
                    processData: false,
                    cache: false,
                    async: true,
                    success: function (res) {
                        console.log(res.task_id);
                        getProgress(
                            res.task_id,
                            progressBarId = "export-corvet-vin-progress-bar",
                            progressBarMessageId = "export-corvet-vin-progress-message",
                            isDownloadFile = true
                        )
                    },
                    error: function (err) {
                        console.log(err);
                    },
                })
            })

            $("#export-reman").on("submit", (e) => {
                e.preventDefault()
                let formData = new FormData($("#export-reman")[0])
                // formData.append("csrfmiddlewaretoken", "{% csrf_token %}")
                $.ajax({
                    type: "POST",
                    url: "{% url 'import_export:export_reman' %}",
                    data: formData,
                    contentType: false,
                    processData: false,
                    cache: false,
                    async: true,
                    success: function (res) {
                        console.log(res.task_id);
                        getProgress(
                            res.task_id,
                            progressBarId = "export-reman-progress-bar",
                            progressBarMessageId = "export-reman-progress-message",
                            isDownloadFile = true
                        )
                    },
                    error: function (err) {
                        console.log(err);
                    },
                })
            })
        });
    </script>

{% endblock %}
